# Ticketing Systems (when MCP is not configured)

> **This file vs `agent/fetch-ticket.sh`**: `fetch-ticket.sh` (generated by install.sh) is the quick wrapper. This file is the **detailed reference** â€” use it when `fetch-ticket.sh` is not available or when you need to customize.

## Token sources
- **Environment:** `LINEAR_API_TOKEN`, `JIRA_API_TOKEN` + `JIRA_URL`, `GITHUB_TOKEN` + `GITHUB_REPO`
- **agent-config.md:** If using `agent/fetch-ticket.sh`, it reads uncommented `VAR=value` lines from `agent-config.md`.

---

## Linear

```bash
linear_issue_md() {
  local ISSUE_ID="$1"
  local TOKEN="${LINEAR_API_TOKEN:-}"
  if [ -z "$TOKEN" ]; then echo "Error: LINEAR_API_TOKEN not set"; return 1; fi
  curl -s https://api.linear.app/graphql \
    -H "Content-Type: application/json" \
    -H "Authorization: $TOKEN" \
    -d "{\"query\": \"query { issue(id: \\\"$ISSUE_ID\\\") { id identifier title description state { name } assignee { name } } }\"}" | \
  jq -r '.data.issue | "# [\(.identifier)] \(.title)\n\n## Description\n\(.description // "")\n\n## State\n\(.state.name)\n\n## Assignee\n\(.assignee.name // "Unassigned")"'
}
```

---

## Jira

```bash
jira_issue_md() {
  local ISSUE_KEY="$1"
  local TOKEN="${JIRA_API_TOKEN:-}"
  local URL="${JIRA_URL:-}"
  if [ -z "$TOKEN" ] || [ -z "$URL" ]; then echo "Error: JIRA_API_TOKEN and JIRA_URL must be set"; return 1; fi
  curl -s "$URL/rest/api/3/issue/$ISSUE_KEY" \
    -H "Authorization: Bearer $TOKEN" \
    -H "Content-Type: application/json" | \
  jq -r '"# [\(.key)] \(.fields.summary)\n\n## Description\n\(.fields.description.content[0].content[0].text // "No description")\n\n## Status\n\(.fields.status.name)\n\n## Assignee\n\(.fields.assignee.displayName // "Unassigned")"'
}
```

---

## GitHub Issues

```bash
github_issue_md() {
  local REPO="${GITHUB_REPO:-}"
  local NUM="$1"
  local TOKEN="${GITHUB_TOKEN:-}"
  if [ -z "$TOKEN" ] || [ -z "$REPO" ]; then echo "Error: GITHUB_TOKEN and GITHUB_REPO must be set"; return 1; fi
  curl -s "https://api.github.com/repos/$REPO/issues/$NUM" \
    -H "Authorization: token $TOKEN" \
    -H "Accept: application/vnd.github.v3+json" | \
  jq -r '"# [#\(.number)] \(.title)\n\n## Description\n\(.body // "No description")\n\n## State\n\(.state)\n\n## Assignee\n\(.assignee.login // "Unassigned")"'
}
```

---

## Using in the project

1. **Prefer `agent/fetch-ticket.sh`** if present.
2. **Otherwise** copy the functions above, set env vars, and run.
3. **Save to `tickets/`**: `linear_issue_md "<uuid>" > tickets/PROJ-123.md`

**Dependencies:** `curl` and `jq` must be available.
